1. ASM + C
1. MSVC(Visual Studio) ìŠ¤íƒ€ì¼ ì¸ë¼ì¸ ì–´ì…ˆë¸”ë¦¬ ì˜ˆì œ
#include <stdio.h>

int add2(int x) {
    __asm {
        mov eax, x   ; eax ë ˆì§€ìŠ¤í„°ì— ë§¤ê°œë³€ìˆ˜ x ê°’ ë¡œë“œ
        add eax, 2   ; eax = eax + 2
        mov x, eax   ; ê²°ê³¼ë¥¼ ë‹¤ì‹œ xì— ì €ì¥
    }
    return x;        ; x(= eax + 2) ë°˜í™˜
}

int main(void) {
    int a = 10;
    int b = add2(a);   // 10 + 2 = 12

    printf("a = %d, add2(a) = %d\n", a, b);
    return 0;
}

 GCC ìŠ¤íƒ€ì¼ ì¸ë¼ì¸ ì–´ì…ˆë¸”ë¦¬ ì˜ˆì œ

ë¦¬ëˆ…ìŠ¤ + gcc í™˜ê²½ì´ë©´ ë³´í†µ ì´ë ‡ê²Œ ì”€:

#include <stdio.h>

int add2(int x) {
    int result;
    __asm__ (
        "movl %1, %%eax\n\t"  // eax = x
        "addl $2, %%eax\n\t"  // eax = eax + 2
        "movl %%eax, %0\n\t"  // result = eax
        : "=r"(result)        // ì¶œë ¥ í”¼ì—°ì‚°ì
        : "r"(x)              // ì…ë ¥ í”¼ì—°ì‚°ì
        : "%eax"              // ì‚¬ìš©(ë³€ê²½)í•œ ë ˆì§€ìŠ¤í„°
    );
    return result;
}

int main(void) {
    int a = 10;
    int b = add2(a);
    printf("a = %d, add2(a) = %d\n", a, b);
    return 0;
}

2. ë¼ì´ë¸ŒëŸ¬ë¦¬

âœ… Windows (MSVC + MASM) ê¸°ì¤€: C + ASM ë¼ì´ë¸ŒëŸ¬ë¦¬ ë§Œë“¤ê¸° (.lib)
ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡° ì˜ˆì‹œ
MyLib/
 â”œâ”€ add2.c
 â”œâ”€ add2.asm
 â””â”€ Makefile (ì„ íƒ)

1) add2.c
// add2.c
int add2(int x);   // ì–´ì…ˆë¸”ë¦¬ í•¨ìˆ˜ ì„ ì–¸

int add2_with_caller(int x) {
    return add2(x);   // ASM í•¨ìˆ˜ í˜¸ì¶œ
}

2) add2.asm (MASM x86)
; add2.asm
; int add2(int x);

.386
.model flat, c
public add2

.code
add2 PROC
    mov eax, [esp+4]    ; íŒŒë¼ë¯¸í„° x
    add eax, 2
    ret
add2 ENDP

END

3) ë¼ì´ë¸ŒëŸ¬ë¦¬ ë§Œë“¤ê¸° ëª…ë ¹ì–´

Visual Studio Developer Command Promptì—ì„œ:

ml /c /coff add2.asm
cl /c add2.c
lib /OUT:MyLib.lib add2.obj add2.obj


ì™„ì„±: MyLib.lib

4) ì‚¬ìš© ì˜ˆ (main.c)
#include <stdio.h>

int add2_with_caller(int x);

int main() {
    printf("%d\n", add2_with_caller(10));  // 12 ì¶œë ¥
    return 0;
}


ë¹Œë“œ:

cl main.c MyLib.lib

âœ… Linux (GCC + GAS) ê¸°ì¤€: C + ASM ë¼ì´ë¸ŒëŸ¬ë¦¬(.a) ë§Œë“¤ê¸°
ğŸ“ êµ¬ì¡°
MyLib/
 â”œâ”€ add2.c
 â”œâ”€ add2.s

1) add2.c
// add2.c
int add2(int x);  // ASM í•¨ìˆ˜ ì„ ì–¸

int add2_with_caller(int x) {
    return add2(x);
}

2) add2.s (AT&T GAS ë¬¸ë²•)
.global add2
add2:
    movl 4(%esp), %eax
    addl $2, %eax
    ret

3) ì˜¤ë¸Œì íŠ¸ ë§Œë“¤ê¸°
gcc -c add2.c
gcc -c add2.s

4) ì •ì  ë¼ì´ë¸ŒëŸ¬ë¦¬ ìƒì„±
ar rcs libmylib.a add2.o add2.o

5) ì‚¬ìš©(main.c)
#include <stdio.h>

int add2_with_caller(int x);

int main() {
    printf("%d\n", add2_with_caller(10));
    return 0;
}


ë¹Œë“œ:

gcc main.c -L. -lmylib

3. DDL

âœ… C + ASM DLL ë§Œë“¤ê¸° (Windows, MSVC + MASM, x86)
ğŸ“ í´ë” êµ¬ì¡°
MyDLL/
 â”œâ”€ mydll.c
 â”œâ”€ add2.asm
 â”œâ”€ mydll.def   (ì„ íƒ)
 â””â”€ main.c      (í…ŒìŠ¤íŠ¸ìš©)

1) C ì½”ë“œ â€” mydll.c
// mydll.c
__declspec(dllexport) int add2(int x);   // ASM í•¨ìˆ˜ ì„ ì–¸ (export)

__declspec(dllexport) int add2_with_caller(int x) {
    return add2(x);   // ASM í•¨ìˆ˜ í˜¸ì¶œ
}

2) ASM ì½”ë“œ â€” add2.asm (MASM)
; add2.asm
; int add2(int x);

.386
.model flat, stdcall      ; DLLì—ì„œëŠ” stdcallì„ ë§ì´ ì‚¬ìš©í•¨
option casemap:none

public add2

.code
add2 PROC x:DWORD
    mov eax, x
    add eax, 2
    ret
add2 ENDP

END

3) .def íŒŒì¼(ì„ íƒ) â€” mydll.def
LIBRARY "MyDLL"
EXPORTS
    add2
    add2_with_caller


.def íŒŒì¼ ì—†ì´ë„ __declspec(dllexport)ë©´ ìë™ exportë¨.

4) DLL ë¹Œë“œ ëª…ë ¹ì–´

Visual Studio Developer Command Promptì—ì„œ:

ml /c /coff add2.asm
cl /c mydll.c

link /DLL /OUT:MyDLL.dll mydll.obj add2.obj /DEF:mydll.def


ìƒì„±ë˜ëŠ” íŒŒì¼:

MyDLL.dll â† ì‹¤ì œ DLL

MyDLL.lib â† import library (ë‹¤ë¥¸ C í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©)

MyDLL.exp â† export ì •ë³´

5) DLL ì‚¬ìš© ì˜ˆì œ â€” main.c
#include <stdio.h>

__declspec(dllimport) int add2_with_caller(int x);

int main() {
    printf("Result: %d\n", add2_with_caller(10)); // 12
    return 0;
}

6) ì‹¤í–‰ íŒŒì¼ ë¹Œë“œ
cl main.c MyDLL.lib
